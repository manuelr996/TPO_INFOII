/*******************************************************************************************************************************//**
 *
 * @file		Funciones.c
 * @brief		Descripcion del modulo
 * @date		26 oct. 2017
 * @author		Tomás Bautista Ordóñez
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "Funciones.h"

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/
#define temp 0
#define hum 1
/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/
/**
	\fn  MostrarSensores
	\brief Funcion que muestra al usuario el estado de los diferentes sensores
 	\author Tomás Bautista Ordóñez
 	\date 26 oct. 2017
*/
void MostrarSensores( void )
{
	uint8_t Humedad = GetHumedadSuelo();
	uint16_t Temp = GetTemperatura();

	char aux[8];


	FuncLluvia();

	Display( Humedad , DSP1 );
	ComponerMedicion( aux , Humedad, hum);
	TransmitirString( aux );

	Display( Temp , DSP0 );
	PrenderDP(1);
	ComponerMedicion( aux , Temp, temp);
	TransmitirString( aux );

	SetTimer(E_Display,T_Display);
}
/**
	\fn  FuncLluvia
	\brief Refleja al exterior el estado de la variable Lluvia
 	\author Tomás Bautista Ordóñez
 	\date 26 oct. 2017
*/
void FuncLluvia( void )
{
	 if( GetLluvia() == ON )
	 {
		 LedLluvia_On();
		 TransmitirString(MENSAJE_LLUVIA_ON);
	 }
	 else
	 {
		LedLluvia_Off();
		TransmitirString(MENSAJE_LLUVIA_OFF);
	 }
}

void ComponerMedicion(char *string, uint8_t med, uint8_t flag)
{
	string[0] = '#';
	if(flag == temp)
	{
		string[1] = 't';
		string[2] = (med/100) +'0' ;
		med%=100;
		string[3] = (med/10) +'0';
		med%=10;
		string[4] = med+'0';
		string[5] = '$';
		string[7] = '\0';
	}
	else
	{
		string[1] = 'h';
		string[2] = (med/10) + '0';
		string[3] = (med%10) + '0';
		string[4] = '$';
		string[6] = '\0';
	}
}
