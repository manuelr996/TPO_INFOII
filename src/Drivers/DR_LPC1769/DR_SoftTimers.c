/*******************************************************************************************************************************//**
 *
 * @file		DR_SoftTimers.c
 * @brief		Descripcion del modulo
 * @date		23 jul. 2017
 * @author		Tomás Bautista Ordóñez
 *
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** INCLUDES
 **********************************************************************************************************************************/
#include "DR_SoftTimers.h"

/***********************************************************************************************************************************
 *** DEFINES PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** MACROS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TIPOS DE DATOS PRIVADOS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** TABLAS PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PUBLICAS
 **********************************************************************************************************************************/
extern volatile	uint32_t Tmr_Run[ N_TIMERS ];
extern volatile	uint8_t  TMR_Events[ N_TIMERS ];
extern void 	 	(* TMR_handlers [N_TIMERS]) (void);
extern volatile uint8_t  TMR_StandBy[ N_TIMERS ];
extern volatile uint8_t  Tmr_Base[ N_TIMERS ];
/***********************************************************************************************************************************
 *** VARIABLES GLOBALES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

/***********************************************************************************************************************************
 *** PROTOTIPO DE FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES PRIVADAS AL MODULO
 **********************************************************************************************************************************/

 /***********************************************************************************************************************************
 *** FUNCIONES GLOBALES AL MODULO
 **********************************************************************************************************************************/
/**
	\fn  	void TimerEvent (void)
	\brief 	Ejecuta las funciones de los eventos vencidos
 	\author Tomás Bautista Ordóñez
 	\date 	23 jul. 2017
	\return void
*/
void TimerEvent (void)
{
    uint8_t i;

    for(i=0 ; i < N_TIMERS ; i++)
        if(TMR_Events[i])
        {
            TMR_handlers[i]();
            TMR_Events[i] = 0;
        }
}
/**
	\fn  	void AnalizarTimer (void)
	\brief 	Descuenta ticks y marca los eventos vencidos
 	\author Tomás Bautista Ordóñez
 	\date 	23 jul. 2017
	\return void
*/
void AnalizarTimer (void)
{
    uint8_t i;

    for(i=0 ; i< N_TIMERS ; i++)
        if(Tmr_Run[i] && !TMR_StandBy[i])
        {
            Tmr_Run[i]--;
            if(!Tmr_Run[i])
                TMR_Events[i] = 1;
        }
}
